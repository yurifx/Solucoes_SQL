/*
Divergência entre 6.1 + 6.1.1 <> 6.10
*/

--6.1
--Vales emitidos por devolução

SELECT * FROM (SELECT TIT.CODFIL CODFIL, NUMNOTA, VLORIG VLTOTAL61
														 FROM CRC_TITULO        TIT
															INNER JOIN 												CRC_ORIGEM ORIG 
															ON TIT.CODORIGCRC = ORIG.CODORIGCRC
															AND ORIG.CODGRPORIGCRC = 8
															WHERE TIT.TPCLICRC = 1
															AND TIT.CODFIL IN (&CODFIL, &CODDEP)
															AND TIT.DTEMISSAO = TO_DATE('&DATA')
															AND TIT.STATUS <> 9
															AND TIT.NUMNOTA IS NOT NULL
UNION ALL

--6.1.1
--Cancelamento dos vales emitidos por devolução
SELECT EN.CODFIL CODFIL, EN.NUMNOTA, EN.VLTOTAL VLTOTAL61
 FROM ENT_NOTA EN, MOV_SAIDA MV
 WHERE EN.CODFILSAI = MV.CODFIL
   AND EN.NUMNOTASAI = MV.NUMNOTA
   AND EN.TPNOTASAI = MV.TPNOTA
   AND EN.SERIESAI = MV.SERIE
   AND EN.DTNOTASAI = MV.DTNOTA
   AND EN.CODFIL IN (&CODFIL, &CODDEP)
   AND EN.TPNOTA IN (5, 53)
   AND EN.DTNOTA = TO_DATE('&DATA')
   AND EN.STATUS = 9
   AND MV.CONDPGTO <> 33
			ORDER BY VLTOTAL61 DESC) T1
			
--OU ESSE SELECT DE CANCELAMENTOS DOS VALES EMITIDOS POR DEVOLUÇÃO
/*
SELECT EN.NUMNOTA, EN.VLTOTAL VLTOTAL
FROM ENT_NOTA EN
AND EN.CODFIL IN (&CODFIL, &CODDEP)
AND EN.TPNOTA IN (5, 53)
AND EN.DTNOTA = TO_DATE('&DATA')
AND EN.STATUS = 9
ORDER BY VLTOTAL
*/	
			
--10
LEFT JOIN (SELECT EN.CODFIL CODFIL, EN.NUMNOTASAI, EN.NUMNOTA, EN.VLTOTAL VLTOTAL_ENTRADA
													  FROM ENT_NOTA EN
														 WHERE CODFIL IN (&CODFIL, &CODDEP)
														 AND TPNOTA IN (5, 53)
														 AND DTNOTA = '&DATA'
															AND STATUS <> 9) T2
															ON			T2.VLTOTAL_ENTRADA = T1.VLTOTAL61 * (-1)
															AND		T1.NUMNOTA = T2.NUMNOTASAI
															
			
											-------------- FIM  ---------------
			
			
/*
			
			
--NOTAS DE ENTRADA 
SELECT *--EN.NUMNOTASAI, EN.VLTOTAL
FROM ENT_NOTA EN
WHERE CODFIL IN (&CODFIL, &CODDEP)
AND TPNOTA IN (5, 53)
AND DTNOTA = '&DATA'
AND STATUS <> 9;			
			
			
			
			
--TITULOS	
			
SELECT *--NUMNOTA, VLORIG VLTOTAL
FROM CRC_TITULO        TIT
INNER JOIN 												CRC_ORIGEM ORIG 
ON TIT.CODORIGCRC = ORIG.CODORIGCRC
AND ORIG.CODGRPORIGCRC = 8
WHERE TIT.TPCLICRC = 1
AND TIT.CODFIL IN (&CODFIL, &CODDEP)
AND TIT.DTEMISSAO = TO_DATE('&DATA')
AND TIT.STATUS <> 9
AND TIT.NUMNOTA IS NOT NULL;


*/